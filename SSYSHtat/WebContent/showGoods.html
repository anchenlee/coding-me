<!DOCTYPE>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="js/json_parse.js"></script>
    <script type="text/javascript" src="js/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <title>后台管理</title>
    <style type="text/css">
        table tr:hover{
            background: #f0f0f0;
        }
        table img{
            border: 1px solid #b9def0;
            border-radius: 5px;
        }
        table img:hover{
            border-color: #0088cc;
        }
    </style>
</head>
<body>
    <div class="panel panel-primary" style="width: 180px;float: left;box-shadow: 0 0 10px #aaa">
        <div class="panel-heading" style="font-size: 24px;line-height: 40px;text-align: center;text-shadow: 0 0 10px #000;">后台管理</div>
        <div class="panel-body" style="font-size: 20px;text-align: center;">
            <a href="itemsugmanage.html">商品信息</a>
        </div>
        <div class="panel-body" style="font-size: 20px;text-align: center">
            <a href="statrealtime.html">统计信息</a>
        </div>
        <div class="panel-body" style="font-size: 20px;text-align: center">
            <a href="keyWord.html">关键字查询</a>
        </div>
        <div class="panel-body" style="font-size: 20px;text-align: center">
            <a href="showGoods.html">商品库管理</a>
        </div>
    </div>
    <div class="panel panel-default main-panel" id="content" style="width: 1200px">
        <div class="panel-heading">
            <h1 style="display: inline;" class="panel-title">商品展示</h1>
            <!--<button type="button" class="btn btn-mini btn-info" onclick="location.href='addGoods.html'" style="float: right">添加商品</button>-->
            <button type="button" class="btn btn-info btn-sm"  data-toggle="modal" data-target="#myModalAdd" style="float: right">添加商品</button>
            <button type="button" class="btn btn-warning btn-sm" onclick="confirmDel()" style="float: right;margin-right: 20px;">删 除</button>
        </div>
        <div class="panel-body" style="position: relative;">
            <div class="panel panel-info main-panel">
                <div class="panel-heading">
                    <h2>商品库</h2>
                </div>
                <div class="panel-body">
                    <table class="table" id="showList">
                        <tr><th style="width: 100px">商品ID</th><th style="width: 200px">商品名称</th><th style="width: 300px">商品图片</th><th style="width: 160px">商品价格(￥)</th><th style="width: 200px">相关操作</th></tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- 修改商品信息 -->
    <div class="modal fade bs-example-modal-lg" id="myModalEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close btn-sm" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h2 class="modal-title" id="myModalLabel">修改商品信息</h2>
                </div>
                <div class="modal-body">
                    <form class="form" role="form" style="width: 550px;margin: 0 auto;padding: 30px 0;">
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品编号</div>
                                <input class="form-control" type="text" id="editPid" disabled placeholder="商品ID">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品名称</div>
                                <input class="form-control" type="text" id="editTitle" placeholder="商品名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品图片</div>
                                <input class="form-control" type="text" id="editImg" placeholder="商品图片">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品价格</div>
                                <input class="form-control" type="number" id="editPrice" placeholder="商品价格">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="confirmEdit()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加商品 -->
    <div class="modal fade bs-example-modal-lg" id="myModalAdd" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close btn-sm" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h2 class="modal-title" id="myModalLabel">添加商品</h2>
                </div>
                <div class="modal-body">
                    <form class="form" role="form" style="width: 550px;margin: 0 auto;padding: 30px 0;">
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品编号</div>
                                <input class="form-control" type="text" id="addPid" placeholder="商品ID">
                            </div>
                        </div>
                        <!--<div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品名称</div>
                                <input class="form-control" type="text" id="addTitle" placeholder="商品名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品图片</div>
                                <input class="form-control" type="text" id="addImg" placeholder="商品图片">
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <div class="input-group-addon">商品价格</div>
                                <input class="form-control" type="number" id="addPrice" placeholder="商品价格">
                            </div>
                        </div>-->
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="confirmAdd()">保存</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    var data;
    var jsonList;
    $(document).ready(function(){
        var height = $(window).height();
//        alert(height);
        if(height>760){
            $('.panel-primary').height(height);
        }
        else{
            $('.panel-primary').height(760);
        }
    });

    $.ajax({
        url:'GetSugitems',
        type:'post',
        success:function(ret){
            jsonList = JSON.parse(ret);
            for(var i=0;i<jsonList.length;i++){
               // console.info(jsonList[i].pid);
                data+='<tr><td>'+jsonList[i].pid+'</td><td>'+jsonList[i].title+'</td><td><img src="'+jsonList[i].img+'" style="width:100px;height:100px;"> </td><td>'+jsonList[i].price+'</td>' +
                    '<td> <button type="button" class="btn btn-info btn-sm"  data-toggle="modal" data-target="#myModalEdit" style="vertical-align: top" onclick="Edit(\''+jsonList[i].pid+'\',\''+jsonList[i].title+'\',\''+jsonList[i].img+'\','+jsonList[i].price+')">修 改</button>' +
                     '<input type="checkbox" style="margin-left: 20px;zoom:200%;vertical-align: top;" value=\''+jsonList[i].pid+'\'></td></tr>';
            }
            $('#showList').append(data);
        }
    });


    function confirmAdd(){
        var pid = $("#addPid").val();
       /* var title = $("#addTitle").val();
        var img = $("#addImg").val();
        var price = $("#addPrice").val();*/
        if(pid == ''){
            alert("请输入商品ID");
        }else {
            $.ajax({
                url:'AddSugItems',
                data:'pid='+pid,
                type:'post',
                success:function(ret){
                    alert("添加成功!");
                    window.location.reload();
                }
            });
        }
    }

   function Edit(pid,title,img,price) {
        $("#editPid").val(pid);
        $("#editTitle").val(title);
        $("#editImg").val(img);
        $("#editPrice").val(price);
    }
    function confirmEdit(){
        var pid = $("#editPid").val();
        var title = $("#editTitle").val();
        var img = $("#editImg").val();
        var price = $("#editPrice").val();
        if((pid == '')||(title == '')||(img == '')){alert('商品信息不能为空!')}
        if(isNaN(price)!==false){alert('请输入数字金额!')}
        $.ajax({
            url:'AddSugItems',
            data:'pid='+pid+'&title='+title+'&img='+img+'&price='+price,
            type:'post',
            success:function(ret){
                alert("修改成功!");
                window.location.reload();
            }
        });
    }
    function confirmDel(){
        var pids='';
        var del = $("input[type='checkbox']");
        for(var i=0;i<del.length;i++){
            if(del[i].type=="checkbox"&&del[i].checked==true){
                pids+=del[i].value + ",";
            }
        }
        console.log(pids);
        if(pids==''){
            alert("请选择要删除的信息!");
        }else{
            if (confirm("确认要删除？")) {
                Delete(pids);
            }
        }
    }
    function Delete(pids){
        $.ajax({
            url:'RemoveSugItems',
            data:'pids='+pids,
            type:'post',
            success:function(ret){
                window.location.reload();
            }
        });
    }
</script>
</html>