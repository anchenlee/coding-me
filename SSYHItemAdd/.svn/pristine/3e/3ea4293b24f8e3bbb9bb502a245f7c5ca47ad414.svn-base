<!DOCTYPE>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>商品管理后台</title>
<link href="css/superCheapStyle.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="css/bootstrap.css" />
<link rel="stylesheet" href="css/bootstrap-theme.css" />
<link href="css/custom.css" rel="stylesheet" type="text/css" media="all">
<link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.js"></script>
<script type="text/javascript" src="js/jquery-ui-slide.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-timepicker-addon.js"></script>
<style type="text/css">
.ui-datepicker{width:235px;}
</style>
</head>
<body onload="init()">
		<div class="top-panel">
			<div class="top-logo">
				<img class="logo-img" alt="" src="img/logo.jpg">
				<img class="title-img" alt="" src="img/title.jpg">
				<span class="title">商品管理系统</span>
				<div class="top-tool">
				</div>
			</div>
			<img class="right-img" alt="" src="img/top_right.jpg">
			<ul class="nav nav-tabs menu">
				<li><span class="span_50px"></span></li>
			</ul>
		</div>
		<div class="mainbody">
		<div class="panel panel-default left-panel" >
			<div class="panel-heading">
				<h3 style="display: inline;" class="panel-title">菜单</h3>
			</div>
			<div class="panel-body">
				<ul class="nav nav-pills nav-stacked">
					<li><a>添加新商品</a></li>
					<li><a onclick="location.href='superCheap.html'">查看商品列表</a></li>
					<li><a>添加验证码</a></li>
				</ul>
			</div>
		</div>
		<div class="panel panel-default main-panel" style="width: 1610px">
			<div class="panel-heading">
				<h3 style="display: inline;" class="panel-title">内容</h3>
			</div>
			<div class="panel-body" style="display: inline;position: relative;">
				<div id="dayInfo">
					<div class="dayAds">
					<!-- 添加产品  -->
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">商品名称</span>
					  <input class="usefulInfo form-control" name="title" id="ad_title" type="text" placeholder="商品名称">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">商品ID</span>
					  <input class="usefulInfo form-control" name="ad_id" id="item_id" type="text" placeholder="商品ID">
					</div>
					<div class="input-group" style="margin-top:5px;">
		  				<span class="input-group-addon">商品图片</span>
		  				<input class="usefulInfo form-control" name="img" type="text" id="img" value="" placeholder="">
					</div>
					<form id="upload_gift_ImgForm" method="post" enctype="multipart/form-data" action="" target="ImgUploadIfr">
						    <label></label>
						    <input id="gift_imgFile" name="file" type="file">
						    <input type="button" onclick="add_ImgName(this)" value="上传" class="button">
					</form>
					<iframe name="ImgUploadIfr" style="display:none"></iframe>
				<!--内容结束-->
					<div class="input-group item_tags" style="margin-top:5px;"><!--勾选tags内容-->
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">原价</span>
					  <input class="usefulInfo form-control" name="price_before" type="text" placeholder="原价">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">现价</span>
					  <input class="usefulInfo form-control" name="price_low" type="text" placeholder="现价">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">淘金币</span>
					  <input class="usefulInfo form-control" name="tao_jb" type="text" placeholder="淘金币">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">商品个数</span>
					  <input class="usefulInfo form-control" name="num" type="text" placeholder="商品个数">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">剩余数量</span>
					  <input class="usefulInfo form-control" name="remain_num" id="remain_num" type="text" placeholder="剩余数量">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="btn input-group-addon">选择是否包邮</span>
					  <label class="form-control i_check" style="width:50px;"><input onclick="cPostage(this)" class="usefulInfo postAge" name="postage" type="checkbox" value="0" /><span></span></label><span></span>
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">添加日期</span>
					  <input class="usefulInfo form-control" name="discount_timestamp" id="add_time" type="text" placeholder="个数">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">开始时间</span>
					  <input class="usefulInfo form-control" name="start_timestamp" id="start_time" type="text" placeholder="个数">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">结束时间</span>
					  <input class="usefulInfo form-control" name="end_timestamp" id="end_time" type="text" placeholder="个数">
					</div>
					<div class="input-group" style="margin-top:5px;"><!-- 隐藏功能单独 接口  -->
					  <span class="btn input-group-addon">选择是否隐藏</span>
					  <label class="form-control i_check" style="width:50px;"><input onclick="is_hide(this)" class="usefulInfo is_hide" name="is_hide" type="checkbox" value="1" /><span style="display: inline-block;"></span></label><span></span>
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="btn input-group-addon">选择是否秒杀</span>
					  <label class="form-control i_check" style="width:50px;"><input disabled="true" onclick="is_second_kill(this)" class="usefulInfo is_second_kill" name="is_second_kill" type="checkbox" value="0" /><span></span></label><span></span>
					</div>
					<div class="input-group" style="margin-top:5px;display:none;">
					  <span class="input-group-addon">秒杀价格</span>
					  <input class="usefulInfo form-control" name="kill_price" id="kill_price" type="text" placeholder="秒杀价格">
					</div>
					<div class="input-group" style="margin-top:5px;display:none;">
					  <span class="input-group-addon">秒杀数量</span>
					  <input class="usefulInfo form-control" disabled="true" name="kill_num" id="kill_num" type="text" placeholder="秒杀数量">
					</div>
					<div class="input-group" style="margin-top:5px;display:none;">
					  <span class="input-group-addon">秒杀开始时间</span>
					  <input class="usefulInfo form-control" name="kill_start_timestamp" id="kill_start_timestamp" type="text" placeholder="秒杀开始时间">
					</div>
					<div class="input-group" style="margin-top:5px;display:none;">
					  <span class="input-group-addon">秒杀结束时间</span>
					  <input class="usefulInfo form-control" name="kill_end_timestamp" id="kill_end_timestamp" type="text" placeholder="秒杀开始时间">
					</div>
					<!-- 添加产品结束  -->
					</div><!-- 添加产品结束  -->
					<!-- 添加产品结束  -->
					<div class="input-group" style="margin-top:5px;">
		  				<span class="input-group-addon">轮播大图片</span>
		  				<input class="usefulInfo2 form-control" name="bigImg" type="text" id="bigImg" value="" placeholder="">
					</div>
					<form id="upload_gift_ImgForm" method="post" enctype="multipart/form-data" action="" target="ImgUploadIfr">
						    <label></label>
						    <input id="gift_imgFile" name="file" type="file">
						    <input type="button" onclick="add_ImgName(this)" value="上传" class="button">
					</form>
					<iframe name="ImgUploadIfr" style="display:none"></iframe>
					<div class="input-group" style="margin-top:5px;">
		  				<span class="input-group-addon">轮播小图片</span>
		  				<input class="usefulInfo2 form-control" name="smallImg" type="text" id="smallImg" value="" placeholder="">
					</div>
					<form id="upload_gift_ImgForm" method="post" enctype="multipart/form-data" action="" target="ImgUploadIfr">
						    <label></label>
						    <input id="gift_imgFile" name="file" type="file">
						    <input type="button" onclick="add_ImgName(this)" value="上传" class="button">
					</form>
					<iframe name="ImgUploadIfr" style="display:none"></iframe>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">RGB颜色</span>
					  <input class="usefulInfo2 form-control" maxlength="6" name="color" id="color" type="text" placeholder="RGB颜色">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">fromUID</span>
					  <input class="usefulInfo2 form-control" maxlength="6" name="fromUid" id="fromUid" type="text" placeholder="填写你的id">
					</div>
					<div class="input-group" style="margin-top:5px;display: none;">
					  <span class="input-group-addon">fromUID</span>
					  <input class="usefulInfo2 form-control" maxlength="6" name="superId" id="superId" type="text" placeholder="填写你的id">
					</div>
					<div class="input-group" style="margin-top:5px;">
					  <span class="input-group-addon">优惠券</span>
					  <input class="yhq_url usefulInfo form-control" data-name="" name="yhq_url" id="yhq_url" type="text" placeholder="填写优惠券地址" />
					  <input class="yhq_title usefulInfo form-control" data-name="" name="yhq_title" id="yhq_title" type="text" placeholder="填写优惠券title" />
					</div>
					<button onclick="del_yhq(this)">删除优惠券</button>
					<button id="sub_yhq" onclick="sub_yhq(this)" style="display:none">提交优惠券</button>
				</div>
			</div>
			<!-- 按钮组 -->
			<div style="padding:5px 0;text-align: center;">
				<button type="button" onclick="scSubmit()" class="btn btn-primary">提交</button>
				<button type="button" class="btn btn-primary" onclick="javascript:history.go(-1)">取消</button>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	$('#add_time').datetimepicker({
		timeFormat: "00:00"
	});
	$('#start_time').datetimepicker();
	$('#end_time').datetimepicker();
	if($('#yhq_url').val() == 0){
		$('#sub_yhq').show();
	}
	function initialization(id){
		$.ajax({
			url:"super/superdiscount?method=getInfoById",
			data:"id="+id,
			type:"POST",
			success:function(ret){
				var JSONObj = eval('('+ret+')');
				$('.usefulInfo').eq(0).val(JSONObj.title);
				$('.usefulInfo').eq(1).val(JSONObj.item_id);
				$('.usefulInfo').eq(2).val(JSONObj.img);
				$('.usefulInfo').eq(3).val(JSONObj.price_before);
				$('.usefulInfo').eq(4).val(JSONObj.price_low);
				$('.usefulInfo').eq(5).val(JSONObj.tao_jb);
				$('.usefulInfo').eq(6).val(JSONObj.num);
				$('.usefulInfo').eq(7).val(JSONObj.remain_num);
				$('.usefulInfo').eq(8).val(JSONObj.postage);
				$('.usefulInfo').eq(9).val(JSONObj.discount_timestamp);
				$('.usefulInfo').eq(10).val(JSONObj.start_timestamp);
				$('.usefulInfo').eq(11).val(JSONObj.end_timestamp);
				if($('.postAge').val() == 1){
					$('.postAge').next().css('display','inline-block');
				}
				$('.usefulInfo').eq(12).val(JSONObj.is_hide);
				if(JSONObj.is_hide == 0){
					$('.is_hide').next().css('display','none');
				}
				$('.usefulInfo').eq(13).val(JSONObj.is_second_kill);
				if($('.is_second_kill').val() == 1){
					$('.is_second_kill').next().css('display','inline-block');
					$('.is_second_kill').parents('.input-group').nextAll().css('display','table');
				}
				$('.usefulInfo').eq(14).val(JSONObj.kill_price);
				$('.usefulInfo').eq(15).val(JSONObj.kill_num);
				$('.usefulInfo').eq(16).val(JSONObj.kill_start_time);
				$('.usefulInfo').eq(17).val(JSONObj.kill_end_time);
				if(JSONObj.super_coupon != ''){
					$('.usefulInfo').eq(18).val(JSONObj.super_coupon.coupon_address);
					$('.usefulInfo').eq(18).attr('data-name',JSONObj.super_coupon.id);
					$('.usefulInfo').eq(18).attr('data-name-copy',JSONObj.super_coupon.item_id);
					$('.usefulInfo').eq(19).val(JSONObj.super_coupon.yhq_title);
				}
				$('.usefulInfo2').eq(0).val(JSONObj.super_web.bigImg);
				$('.usefulInfo2').eq(1).val(JSONObj.super_web.smallImg);
				$('.usefulInfo2').eq(2).val(JSONObj.super_web.color);
				$('.usefulInfo2').eq(3).val(JSONObj.super_web.fromUid);
				$('.usefulInfo2').eq(4).val(JSONObj.super_web.superId);
				var str = '';
				for (var i = 0; i < JSONObj.item_tags.length; i++) {
					var tid = JSONObj.item_tags[i].id;
					$('.tags').each(function(){
						if($(this).attr('name') == tid){
							$(this).val(1);
							$(this).next().css('display','inline-block');
						}
					})
				}
				$('.item_tags').append(''+str+'');
			}
		})
	}
	
	 function init(){  //初始化item_tags
		$.ajax({
			url:"SuperItemTags?method=get_all",
			type:"POST",
			success:function(ret){
				var JSONObj = eval('('+ret+')');
				var str = '';
				for (var j = 0; j < JSONObj.length; j++) {
						str += '<span class="btn input-group-addon">'+JSONObj[j].name+'</span>'
					  		+'<label class="form-control i_check" style="width:50px;"><input onclick="tagchoose(this)" class="tags" name="'+JSONObj[j].id+'" type="checkbox" value="0" /><span></span></label><span></span>';
				}
				$('.item_tags').append(''+str+'');
			}
		})
		var adId = GetQueryString('adId');
		initialization(adId);
	}

	function GetQueryString(name){   //获取浏览器的参数
	    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	    var r = window.location.search.substr(1).match(reg);
	    if(r!=null)return  unescape(r[2]); return null;
	}
	
	function cPostage(obj){
		if($(obj).val()==0){
			$(obj).val(1);
			$('.postAge').next().css('display','inline-block');
		}else{
			$(obj).val(0);
			$('.postAge').next().css('display','none');
		}
	}
	
	function is_second_kill(obj){
		if($(obj).val()==0){
			$(obj).val(1);
			$('.is_second_kill').next().css('display','inline-block');
			$(obj).parents('.input-group').nextAll().css('display','table');
		}else{
			$(obj).val(0);
			$('.is_second_kill').next().css('display','none');
			$(obj).parents('.input-group').nextAll().css('display','none');
		}
	}
	
	function rep(str){
		str = str.replace(/\%/g,"%25"); 
		str = str.replace(/\+/g,"%2b");
		str = str.replace(/\&/g,"%26");
		return str;
	}
	
	function scSubmit(){ //提交
		var id = GetQueryString('adId');
		var info = '{"id":"'+id+'",';
		var str = '"item_tags":"';
		$('.usefulInfo').each(function(){
			var val=$(this).val();
			val=rep(val);
			info += '"'+$(this).attr('name')+'":"'+val+'",';
		});
		$('.tags').each(function(){
			if($(this).val() == 1){
				str += ''+$(this).attr('name')+',';
			}
		});
		info += str;
		//优惠券ID
		info += '","yhq_id":"'+$('#yhq_url').attr('data-name');
		info += '"}';
		console.info(info);
		var super_web ='{';
		$('.usefulInfo2').each(function(){
			super_web += '"'+$(this).attr('name')+'":"'+$(this).val()+'",';
		});
		super_web += '"id":"132456"}';
		$.ajax({
			url:"super/superdiscount?method=updateInfo",
			data:"info="+info+"&super_web="+super_web,
			type:"POST",
			success:function(ret){
				if(ret == 'success'){
					alert('提交成功');
				}else{
					alert('提交失败');
				}
			}
		})
	}
	
	function del_yhq(obj){//删除优惠券
		var itemId = $('.usefulInfo').eq(18).attr('data-name-copy');
		var id = $('.usefulInfo').eq(18).attr('data-name');
		$.ajax({
			url:"super/superdiscount?method=delyhq",
			data:"item_id="+itemId+"&id="+id,
			type:"POST",
			success:function(ret){
				if(ret == 'success'){
					$(obj).prev().remove();
					$(obj).remove();
				}else{
					alert('删除失败');
				}
			}
		})
	}

	function is_hide(obj){
		if($(obj).val()==0){
			$(obj).val(1);
			$('.is_hide').next().css('display','inline-block');
		}else{
			$(obj).val(0);
			$('.is_hide').next().css('display','none');
		}
	}
	
	function tagchoose(obj){  //标签选择控制
		if($(obj).val()==0){
			$(obj).val(1);
			$(obj).next().css('display','inline-block');
		}else{
			$(obj).val(0);
			$(obj).next().css('display','none');
		}
	}
	
	function sub_yhq(obj){   //提交优惠券
		var item_id = $('#item_id').val();  //商品id
		var item_title = $('#ad_title').val(); //商品title
		var yhq_id = $('#yhq_url').attr('data-name');//优惠券id 
		var yhq_title = $('#yhq_title').val();  //优惠券title  
		var yhq_url = rep($('#yhq_url').val());  //优惠券地址
		$.ajax({
			url:'super/superdiscount?method=addyhq',
			data:'item_id='+item_id+'&yhq_title='+yhq_title+'&yhq_url='+yhq_url+'&item_title='+item_title,
			type:'POST',
			success:function(ret){
				if(ret == 'success'){
					alert('提交成功');
				}else{
					alert('提交失败');
				}
			}
		})
	}
	
	//上传图标
	function add_ImgName(obj)
	{
		var date = (new Date()).valueOf();
	    var filename = $(obj).prev().val(); 
	    var suffix = filename.substring(filename.lastIndexOf("."));
		var prefix = "http://static.etouch.cn/suishou/ad_img/";
		var url = prefix+date+suffix;
	    $(obj).parent().prev().find('input').val(url);
	    $(obj).parent().attr('action','http://a.suishouyouhui.cn/img/upload?imgsn='+date);
	    $(obj).parent().submit();
	}
</script>
</html>