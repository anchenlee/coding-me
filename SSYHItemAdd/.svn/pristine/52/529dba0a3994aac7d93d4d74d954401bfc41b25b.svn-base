<!DOCTYPE>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<!-- 最新 Bootstrap 核心 CSS 文件 -->
<link href="css/superCheapStyle.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css">
<!-- 可选的Bootstrap主题文件（一般不用引入） -->
<link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap-theme.min.css">
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="js/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.js"></script>
<link href="css/custom.css" rel="stylesheet" type="text/css" media="all">
<style type="text/css">
    body{
        font-family: "microsoft yahei";
        font-size: 14px;;
    }
    .dayTitle{
        display: inline-block;
        margin-left: 10px;
        cursor: pointer;
        background: #f5f5f5;
        padding: 5px;;
    }
    .thumbnail:hover{
        border-color: #0099CC;
    }
    .chosed{
        background: #fa0;
        color: #fff;;
    }
</style>
</head>
<body onload="ol()">
			<div class="panel-body adBody" style="position: relative;">
			</div>
</body>
<script type="text/javascript">
	var pagNow;
	function getPagNow(){
		pagNow=GetQueryString('pagNow');
		if( pagNow== null){
			return "";
		}else{
			return pagNow;
		}
	}
	function superCheapAdd(obj){
		var url = $(obj).attr('name');
		location.href = url;
	}
	
	function viewAssess(id){
		var itemId =  id;
		parent.document.getElementById("showDiv").src="AssessList.html?type=1&itemId=" + itemId + "&date=" + pagNow;
	}
	
	function ol(){
		pagNow=getPagNow();
		$.ajax({
		url:"super/superdiscount?method=getInfo&pagNow="+pagNow,
		type:"POST",
		success:function(ret){
			var JSONObj = eval('('+ret+')');
			if(JSONObj.date != '' ){
			$('.superCheapAdd').attr('name','superCheapAdd.html?date='+JSONObj.date+'');
			var son = '';
			var str = '';
			for(var j=0;j<JSONObj.items.length;j++){
					son += '<div class="dayAd">'
								+'<div class="thumbnail" style="margin:0;">'
								/*+'<em id="ad_0" name="'+JSONObj.items[j].id+'" onmousedown="moveAd(this)" style="display:block;height:50px;cursor: move;">点击我就可以拖拽了 少年</em>'*/
							    +'<img src="'+JSONObj.items[j].img+'" alt="">'
								+'<p class="dayAd" style="width: 180px;"><b>价格:</b> '+JSONObj.items[j].price_low+'</p>'
								+'<p class="dayAd" style="height: 60px;width: 180px;"><b>标题:</b> '+JSONObj.items[j].title+'</p>'
								+'<p class="dayAd" style="width: 180px;"><b>评论个数:</b> '+JSONObj.items[j].assess_count+'</p>';
							son	+= '<button style="margin-left:5px;" onclick="viewAssess('+JSONObj.items[j].item_id+')" class="btn btn-primary btn-sm">查看评论</button>'
								+'</div>'
							+'</div>';
			}
			for(var i=0;i<JSONObj.totaldates.length;i++){
				var tttime = getTimeChuo(JSONObj.totaldates[i]);
				str += '<div onclick="changeDate(this)" name="'+JSONObj.totaldates[i]+'" class="dayTitle date'+JSONObj.totaldates[i]+'">'+tttime+'</div>';
			}
				$('.adBody').append('<div>'+str+'<div class="dayAds">'+son+'</div></div>');
				if("" == pagNow){
					pagNow = JSONObj.totaldates[0];
				}
				$('.dayTitle').each(function(){
					$(this).removeClass('chosed');
					if($(this).attr('name') == pagNow){
						$(this).addClass('chosed');
					}	
				});
				son = '';
			}else{
				$('.superCheapAdd').attr('name','superCheapAdd.html');
			}
		}
	});
	}
	
	function GetQueryString(name){   //获取浏览器的参数
	     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	     var r = window.location.search.substr(1).match(reg);
	     if(r!=null)return  unescape(r[2]); return null;
	}
	
	//初始化后台请求结束
   
   var position_array = new Array();
   var isDraging=false; //是否可以拖拽
   var mouseOffsetX = 0;   //偏移
   var mouseOffsetY = 0;
   var dragObj={};//拖拽对象
   //获取类对象
   	function moveAd(obj){
   		var e = e||window.event;
   		dragObj.o = obj.parentNode.parentNode;
   		dragObj.id = obj.id;
   		dragObj.id = parseInt(dragObj.id.substr(3));/*  获取拖拽div的id */
   		dragObj.realid = obj.getAttribute('name');
   		dragObj.o.style.filter='alpha(opacity=60)'; //拖动透明效果(IE)
   		var shang = parseInt(dragObj.id / 6);  //第几行
   		var yu = dragObj.id % 6;	//第几列
   		var target_top = shang*232;  //算出top值
   		var target_left = yu*200;  //算出left值
   		dragObj.o.style.top = target_top +'px';
   		dragObj.o.style.left = target_left +'px';
   		dragObj.o.style.zIndex = 1000;
   		dragObj.o.style.position = 'absolute';
   		dragObj.o.style.opacity='0.6';//拖动透明效果(firefox)
   		mouseOffsetX = e.pageX - dragObj.o.offsetLeft;
   		mouseOffsetY = e.pageY - dragObj.o.offsetTop;
   		isDraging = true;
   		/* }); */
   	}

//鼠标移动
document.onmousemove = function(e){
	var e = e || window.event;
	var mouseX = e.pageX;//鼠标当前的位置
	var mouseY = e.pageY;
	
	var moveX = 0;  //div的新位置
	var moveY = 0;
	
	if( isDraging === true){
		moveX = mouseX - mouseOffsetX;
		moveY = mouseY - mouseOffsetY;
		
		var pageWidth = document.documentElement.clientWidth;
		var pageHeight = document.documentElement.clientHeight;
		
		var dialogWidth = dragObj.o.offsetWidth;
		var dialogHeight = dragObj.o.offsetHeight;
		
		var maxX = (pageWidth - dialogWidth)*0.98;
		var maxY = pageHeight - dialogHeight;
		
		moveX = Math.min( maxX,Math.max(0,moveX));
		moveY = Math.min( maxY,Math.max(0,moveY));
		
		dragObj.o.style.left = moveX + 'px';
		dragObj.o.style.top= moveY + 'px';
	}
};

document.onmouseup = function(){//鼠标松开
	var newLeft = parseInt(dragObj.o.style.left);//当前拖拽的div的  left
	var newTop = parseInt(dragObj.o.style.top);//当前拖拽的div的  top
	
	//寻找位置
	var cols = newLeft / 200;  //列
	var rows_judge = newTop % 232;   //通过余数判断位置
	var rows = parseInt(newTop / 232);

	if(cols < 0 && -1<cols){  //属于第0列
		if(rows_judge <100){      //属于上一行
			cols = 0;
		}else if (rows_judge >180){       //属于下一行
			rows++;
			cols = 0;
		}
	}
	else if(cols < 1 && 0<cols){ //属于第1列
		if(rows_judge <100){
			cols = 1;
		}else if (rows_judge >180){
			rows++;
			cols = 1;
		}
	}
	else if(cols < 2 && 1<cols){ //属于第2列
		if(rows_judge <100){
			cols = 2;
		}else if (rows_judge >180){
			rows++;
			cols = 2;
		}
	}
	else if(cols < 3 && 2<cols){ //属于第3列
		if(rows_judge <100){
			cols = 3;
		}else if (rows_judge >180){
			rows++;
			cols = 3;
		}
	}
	else if(cols < 4 && 3<cols){ //属于第4列
		if(rows_judge <100){
			cols = 4;
		}else if (rows_judge >180){
			rows++;
			cols = 4;
		}
	}
	else if(cols < 5 && 4<cols){ //属于第5列
		if(rows_judge <100){
			cols = 5;
		}else if (rows_judge >180){
			rows++;
			cols = 5;
		}
	}
	else if(5<cols){ //属于第0列
			cols = 0;
			rows++;
	}
	exchangPosition(rows,cols);
	    //寻找位置结束 
	isDraging = false;
	dragObj={};
	resetID();
};

function exchangPosition(exRows,exCols)   //调整位置(行，列)
{
	var exID = exCols + exRows * 6;
	while(exID>0){
		if(document.getElementById('ad_'+exID)!=null){
			exID++;
			break;
		}else{
			exID--;
		}
	}
	var moveID = $('#ad_'+exID).attr('name');
	var addDiv = dragObj.o.innerHTML;
	$('#ad_'+dragObj.id).parents('.dayAd').remove();
	if(exID == 0){
		$('.dayAds').prepend('<div class="dayAd">'+addDiv+'</div>');
	}else{
		exID--;
		$('#ad_'+exID).parents('.dayAd').after('<div class="dayAd">'+addDiv+'</div>');
	}
}

function changeDate(obj){
	var date = $(obj).attr('name');
	window.location.href="GoodsList.html?pagNow="+date;
}

Date.prototype.format = function(format)
{
 var o = {
 "M+" : this.getMonth()+1, //month
 "d+" : this.getDate(),    //day
 "h+" : this.getHours(),   //hour
 "m+" : this.getMinutes(), //minute
 "s+" : this.getSeconds(), //second
 "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
 "S" : this.getMilliseconds() //millisecond
 };
 if(/(y+)/.test(format)) format=format.replace(RegExp.$1,
 (this.getFullYear()+"").substr(4 - RegExp.$1.length));
 for(var k in o)if(new RegExp("("+ k +")").test(format))
 format = format.replace(RegExp.$1,
 RegExp.$1.length==1 ? o[k] :
 ("00"+ o[k]).substr((""+ o[k]).length));
 return format;
};

function getTimeChuo(str_time){
	var  str = parseInt(str_time);
	return new Date(str).format('MM.dd');
	}
//拖拽结束
</script>
</html>