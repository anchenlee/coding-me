<!DOCTYPE html>
<html>
<head>
	<title>立即抢购</title>
	<script type="text/javascript" src="js/jquery.js"></script><!--jquery包-->
	<link rel="stylesheet" href="css/style.css"/><!--导入css-->
	<script type="text/javascript" src="js/jquery.lazyload.min.js"></script><!--导入js-->
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/><!--屏幕自适应-->
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><!--字体-->
    <meta content="telephone=no" name="format-detection" /><!--忽略识别电话号码-->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?75879559e59c3ba3d1664abbcb0b53ce";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body class="pr" style="background:#f2f2f2;padding: 0;" onload="fontcontrol()">
<img onclick="hreflogin(this)" class="login" alt="请登录" src="images/login.png" />
</body>
<script type="text/javascript">
	var str = '';
	var leftsec = 0; //剩余时间
	var msec = 0;
	var id = GetQueryString('id');
	var uid = GetQueryString('tyh_web_uid');
	var imggg = new Image();
	imggg.src = 'images/loading_big.png';
	var shareurl = '';
	$.ajax({
		url:'../super/GetSuperById',
		data:'id='+id+'&uid='+uid,
		type:'POST',
		success:function(ret){
			var JSONObj = eval('('+ret+')');
			var imggggg = new Image();
			imggggg.src = ''+JSONObj.img+'';
			shareurl = JSONObj.share_item;
			 /* '<div  onclick="hrefusercodes()" style="z-index:1200;width:16.5%;" class="myallcodes pf"><div class="pr"><img class="width100 db" alt="车篮子" src="images/myallcodes.png"/><span class="myallcodestext db pa cw"></span></div></div>' */
			str = '<div id="SRBTitleBg" class="pr">'
					+'<img class="width100 db" src="images/loading_big.png" alt="预加载图片" />'
					+'<img style="left:0;top:0;" class="width100 db pa imgtestgray" src="'+JSONObj.img+'" alt="商品图片" />';
			if(JSONObj.is_second_kill == 1){  //秒杀
				str += '<span class="limitNum2 di pa cr">限量'+JSONObj.second_kill_num+'件</span>';
			}else{  //非秒杀
				if(JSONObj.limit_num > 0){
					str += '<span class="limitNum2 di pa cr">限量'+JSONObj.limit_num+'件</span>';
				}
			}
				str += '</div>'
				+'<div id="SRBcontent" style="background:#fff;">'
					+'<p class="cb">';
			if (JSONObj.is_baoyou == 1) {    //是否包邮
				str += '<img class="title_icons vt" src="images/title_icon_baoyou.png" />';
			}
			if (JSONObj.is_second_kill == 1){ //是秒杀
				str += '&nbsp'+JSONObj.title+'</p>';
				if(JSONObj.item_tags.length != 0){//添加优惠券信息
					str	+= '<div class="SRBdiv1" style="background:#fff;padding:1% 3%;"><p class="tags">';
					for(var i=0;i<JSONObj.item_tags.length;i++){
						str += '<span onclick="tagexplain('+JSONObj.item_tags[i].id+')" class="tag pxljTag sKill">'+JSONObj.item_tags[i].name+'</span>';
					}
					str += '</p></div>';
				}
				str += '<p><span class="cr discount_price"><b>'+JSONObj.second_kill_price+'集分宝</b></span><span class="original_price useness">￥<b>'+JSONObj.original_price+'</b></span>';
				/* if(JSONObj.tao_jb != 0){
					str += '<span class="tjb"><span class="tjb2">淘金币可抵'+JSONObj.di_tao_jb+'元</span></span>';
				} */
				str	+= '</p></div><div style="padding:0 1%;background:#fff;">'
						+'<img class="width100" src="images/line.png" alt="分割线">'
						+'<div class="SRBdiv1">';
				if(JSONObj.super_coupon != ''){//添加优惠券
					var sc_item_title = '';
					if(JSONObj.super_coupon.yhq_title.length > 14){
						sc_item_title += JSONObj.super_coupon.yhq_title.substr(0,14);
						sc_item_title += '...';
					}else{
						sc_item_title += JSONObj.super_coupon.yhq_title;
					}
				 	str += '<div class="SRBdiv1">'
							+'<img class="ticket" src="images/ticket.png" alt="优惠券图标">'
							+'<span class="cb" style="vertical-align:middle">优惠券：<span class="cr">'+sc_item_title+'</span></span>'
							+'<img onclick="javascript:location.href=\''+JSONObj.super_coupon.coupon_address+'\'" class="getBtn" src="images/getBtn.png" alt="领取优惠券按钮">'
						+'</div>';
				}//添加优惠券结束
						if(JSONObj.order_info==""||JSONObj.order_info=="notfound"){     //    >>>>>>>>>>>>>>>>>>>>>>>>>>>判断购买状态<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
							if(JSONObj.status == 0){  //可以秒杀 状态0
							str += '<p style="text-align:center;">';
							if(JSONObj.limit_num > 0){
								str += '<span class="limitNow cb">仅剩<span class="cr">'+JSONObj.remain_num+'</span>件</span>';
							}
							str	+= '<img class="robBtn" onclick="sckill()" src="images/robBtn.png" alt="立即抢购"></p>';
							}
							else if(JSONObj.status == 1){//还没开始  状态1
							str += '<p style="text-align:center;"><span class="djs_total vm di"><span class="djs hour vb"></span><span class="vb c50">时</span><span class="djs min vb"></span><span class="vb c50">分</span><span class="djs sec vb"></span><span class="vb c50">秒</span></span></span><span class="limitNow cb">即将开始</span>'
								+'<img class="robBtn"  src="images/robBtnBlack.png" alt="立即抢购"></p>';
							countdown(JSONObj.kill_start_timestamp,JSONObj.time_now);   //倒计时
							}
							else if(JSONObj.status == 2){//没了  状态2
							str += '<p style="text-align:center;"><span class="limitNow cb">秒杀结束</span>'
								+'<img class="robBtn" onclick="javascript:location.href=\''+JSONObj.click_url+'\'" src="images/buyBtn.png" alt="原价购买"></p>';
							}
						}else{
							if(JSONObj.order_info.paid_status == 0){      //未付款
								var expiretime = getLocalTime(JSONObj.order_info.order.expireTime);
								str += '<p style="text-align:center;"><span class="limitNow cb">'+expiretime+'后失效</span>'
								+'<img class="robBtn" onclick="javascript:location.href=\'checkcodes.html?orderid='+JSONObj.order_info.order.orderid+'&uid='+uid+'\'" src="images/painbtn_red.png" alt="立即付款"></p>';
							}else if(JSONObj.order_info.paid_status == 1){   //已付款
								if(JSONObj.order_info.secondkill.used == 0){ //抢购成功
									str += '<p style="text-align:center;"><span class="limitNow cb">抢购成功</span>'
									+'<img class="robBtn" onclick="javascript:location.href=\'checkcodes.html?orderid='+JSONObj.order_info.order.orderid+'&uid='+uid+'\'" src="images/buyBtn2.png" alt="立即查看"></p>';
								}else{//已使用
									str += '<p style="text-align:center;"><span class="limitNow cb">抢购成功</span>'
									+'<img class="robBtn" onclick="javascript:location.href=\'checkcodes.html?orderid='+JSONObj.order_info.order.orderid+'&uid='+uid+'\'" src="images/buyBtn2.png" alt="立即查看"></p>';
								}
							}else if(JSONObj.order_info.paid_status == 3){//失效
								//if(JSONObj.status == 2){//没了  状态2
									str += '<p style="text-align:center;"><span class="limitNow cb">订单失效</span>'
										+'<img class="robBtn" onclick="javascript:location.href=\''+JSONObj.click_url+'\'" src="images/buyBtn.png" alt="原价购买"></p>';
	/* 							}else{
									str += '</span><span class="limitNow cb">仅剩<span class="cr" style="vertical-align:top;">'+JSONObj.remain_num+'</span>件</span>'
									+'<img class="robBtn" onclick="sckill()" src="images/robBtn.png" alt="立即抢购">';
								} */
							}
						}
			}//    >>>>>>>>>>>>>>>>>>>>>>>>>>>判断购买状态结束<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
			else{   //不是秒杀
				str += ''+JSONObj.title+'</p>'
				if(JSONObj.item_tags.length != 0){//添加优惠券信息
					str	+= '<div class="SRBdiv1" style="background:#fff;padding:1% 3%;"><p class="tags">';
					for(var i=0;i<JSONObj.item_tags.length;i++){
						str += '<span onclick="tagexplain('+JSONObj.item_tags[i].id+')" class="tag pxljTag sKill">'+JSONObj.item_tags[i].name+'</span>';
					}
					str += '</p></div>';
				}
				str	+= '<p><span class="cr discount_price">￥'+JSONObj.discount_price+'</span><span class="original_price useness">￥<b>'+JSONObj.original_price+'</b></span>';
				if(JSONObj.tao_jb > 0){
					str += '<span class="tjb"><span class="tjb2">淘金币可抵'+JSONObj.di_tao_jb+'元</span></span>';
				}
				str	+= '</p></div><div style="padding:0 1%;background:#fff;">'
						+'<img class="width100" src="images/line.png" alt="分割线">'
						+'<div class="SRBdiv1">'
							+'<span>';
				if(JSONObj.super_coupon != ''){//添加优惠券
					var sc_item_title = '';
					if(JSONObj.super_coupon.yhq_title.length > 14){
						sc_item_title += JSONObj.super_coupon.yhq_title.substr(0,14);
						sc_item_title += '...';
					}else{
						sc_item_title += JSONObj.super_coupon.yhq_title;
					}
				 	str += '<div class="SRBdiv1">'
							+'<img class="ticket" src="images/ticket.png" alt="优惠券图标">'
							+'<span class="cb" style="vertical-align:middle">优惠券：<span class="cr">'+sc_item_title+'</span></span>'
							+'<img onclick="javascript:location.href=\''+JSONObj.super_coupon.coupon_address+'\'" class="getBtn" src="images/getBtn.png" alt="领取优惠券按钮">'
						+'</div>';
				}//添加优惠券结束
				if(JSONObj.status == 0){  //可以购买 状态0
				str += '<p style="text-align:center;">';
				if(JSONObj.limit_num > 0){
					str += '<span class="limitNow cb">仅剩<span class="cr">'+JSONObj.remain_num+'</span>件</span>';
				}
				str	+= '<img class="robBtn" onclick="javascript:location.href=\''+JSONObj.click_url+'\'" src="images/buyBtn3.png" alt="立即购买"></p>';
				}
				else if(JSONObj.status == 1){//还没开始购买  状态1
				str += '<p style="text-align:center;"><span class="djs_total vm di"><span class="djs hour vb"></span><span class="vb c50">时</span><span class="djs min vb"></span><span class="vb c50">分</span><span class="djs sec vb"></span><span class="vb c50">秒</span></span></span><span class="limitNow cb">即将开始</span>'
					+'<img class="robBtn" onclick="" src="images/buyBtnBlack.png" alt="立即购买(灰色)"></p>';
					countdown(JSONObj.start_timestamp,JSONObj.time_now);   //倒计时
				}
				else if(JSONObj.status == 2){//购买结束  状态2
				str += '<p style="text-align:center;"><span class="limitNow cb">购买结束</span>'
					+'<img class="robBtn" onclick="javascript:location.href=\''+JSONObj.click_url+'\'"  src="images/buyBtn.png" alt="原价购买"></p>';
				}
			}
			str +=	'</div></div>';
			/* if(JSONObj.item_tags.length != 0){
				str	+= '<div class="SRBdiv1" style="background:#fff;padding:1% 3%;"><p class="tags">';
				for(var i=0;i<JSONObj.item_tags.length;i++){
					str += '<span onclick="tagexplain('+JSONObj.item_tags[i].id+')" class="tag pxljTag sKill">'+JSONObj.item_tags[i].name+'</span>';
				}
				str += '</p></div>';
			} */
			if(shareurl == ''){
				str += '<img style="margin-top:5%" class="share width100" src="images/share.png" /><p style="text-align:center;"><img class="sharebtn" src="images/sharebtn1.png" alt="微信分享" /><img class="sharebtn" src="images/sharebtn2.png" alt="朋友圈"/><img class="sharebtn" src="images/sharebtn3.png" alt="qq空间"/><img class="sharebtn" alt="微博" src="images/sharebtn4.png" /><img class="sharebtn" alt="腾讯微博" src="images/sharebtn5.png" /></p>';
			}else{
				str += '<img class="share width100" src="images/share.png" /><p style="text-align:center;"><img class="sharebtn" onclick="script:window.location.href=\''+shareurl+'&sns_type=weixin\'" src="images/sharebtn1.png" alt="微信分享" /><img class="sharebtn" onclick="script:window.location.href=\''+shareurl+'&sns_type=pengyou\'" src="images/sharebtn2.png" alt="朋友圈"/><img class="sharebtn" onclick="script:window.location.href=\''+shareurl+'&sns_type=qqkj\'" src="images/sharebtn3.png" alt="qq空间"/><img class="sharebtn" onclick="script:window.location.href=\''+shareurl+'&sns_type=weibo\'" alt="微博" src="images/sharebtn4.png" /><img class="sharebtn" onclick="script:window.location.href=\''+shareurl+'&sns_type=txwb\'" alt="腾讯微博" src="images/sharebtn5.png" /></p>';
			}
			$('body').append(''+str+'');
			$('img.lazy').lazyload();
			fontcontrol();
		}
	})
		
	$(window).resize(function(){
		 fontcontrol();
	})
	
 	function sckill(){   //抢购
 		if(uid == '' || uid == null){
 			$('.login').show();
 		}else{
 			location.href="EnterSecurityCode.html?id="+id+"&uid="+uid+"";
 		}
	} 	
		
	function GetQueryString(name){   //获取浏览器的参数
	     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
	     var r = window.location.search.substr(1).match(reg);
	     if(r!=null)return  unescape(r[2]); return null;
	}
	
	function  fontcontrol() {
		var viewWidth = $(window).width();
		var mFontsize = viewWidth / 28;
		var bFontsize = viewWidth / 25;
		var sFontsize = viewWidth / 30;
		var hFontsize = viewWidth /15;
		if(viewWidth > 640){
			$('body').css('font-size','22.85714285714286px');
			$('.limitNow').css('font-size','25.6px');
			$('.discount_price').css('font-size','42.6666666666667px');
			$('.limitNum2').css('font-size','25.6px');
			$('.tjb').css('font-size','21.33333333333333px');
			$('.djs_total').css('font-size','21.33333333333333px');
			$('.djs').css('font-size','25.6px');
		}else{
			$('body').css('font-size',mFontsize+'px');
			$('.limitNow').css('font-size',bFontsize+'px');
			$('.tjb').css('font-size',sFontsize+'px');
			$('.discount_price').css('font-size',hFontsize+'px');
			$('.djs').css('font-size',bFontsize+'px');
			$('.limitNum2').css('font-size',bFontsize+'px');
			$('.djs_total').css('font-size',sFontsize+'px');
		}
	}

	var stime = 0;
	function countdown(starttime,nowtime){
		stime = starttime;
		var ntime = nowtime;
		msec = parseInt(nowtime / 1000);
		var counttime = stime - ntime;
		if(counttime > 0 && counttime < 259200000){ //开始倒计时
			leftsec = counttime / 1000; //转化成秒   赋给全局变量
			changelefttime();
		}
	}

	var listener = '';
	function changelefttime(){//改变剩余时间显示
		leftsec = parseInt(leftsec);
		if(leftsec >= 0 && leftsec<259200){
			var hour = parseInt(leftsec /3600);;//时
			var minute = parseInt(leftsec % 3600 / 60); //分
			var sec = parseInt(leftsec % 3600 % 60);//秒
			$('.hour').text(zero(hour,2));
			$('.min').text(zero(minute,2));
			$('.sec').text(zero(sec,2));
			if(leftsec <= 0){
				clearInterval(listener);
				location.reload();
			}
			leftsec --;
			msec ++;
			listener = setTimeout(changelefttime,1000);
			if(leftsec % 10 == 0){ // 校准
				$.ajax({
					url:'../Countdown?',
					success:function(ret){
						ret = parseInt((stime - ret) / 1000);
						leftsec = ret;
					}
				})
			}
		}
	}
	
	function zero(num, n) {  //1~9变成01~09
		return (Array(n).join(0) + num).slice(-n);
	}
	
	function tagexplain(tag_id){
		window.location.href="tagExplain.html?tag_id="+tag_id;
	}
	
	function backBtn(){  // 返回上页
		var tyh_web_uid = GetQueryString('uid');
		window.location.href="index.html?tyh_web_uid="+tyh_web_uid;
	}
	
	function hreflogin(obj){   //登录弹出提示
		$(obj).hide();
		window.location.href="suishou://app.youhui.cn/WoDeTaoBaoPage";
	}
	
	function getLocalTime(nS){
		var  str = parseInt(nS);
		return new Date(str).format('MM-dd hh:mm:ss');
	}

	Date.prototype.format = function(format)
	{
	 var o = {
	 "M+" : this.getMonth()+1, //month
	 "d+" : this.getDate(),    //day
	 "h+" : this.getHours(),   //hour
	 "m+" : this.getMinutes(), //minute
	 "s+" : this.getSeconds(), //second
	 "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
	 "S" : this.getMilliseconds() //millisecond
	 }
	 if(/(y+)/.test(format)) format=format.replace(RegExp.$1,
	 (this.getFullYear()+"").substr(4 - RegExp.$1.length));
	 for(var k in o)if(new RegExp("("+ k +")").test(format))
	 format = format.replace(RegExp.$1,
	 RegExp.$1.length==1 ? o[k] :
	 ("00"+ o[k]).substr((""+ o[k]).length));
	 return format;
	}
</script>
</html>