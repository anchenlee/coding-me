/**
 * Created by lianchen on 14-9-23.
 */
//可以用鼠标拖动屏幕
function loadedPanel(what) {
    //We are going to set the badge as the number of li elements inside the target
    $.ui.updateBadge("#aflink", $("#af").find("li").length);
}
function unloadedPanel(what) {
    console.log("unloaded " + what.id);
}
var u = navigator.userAgent;
if(u.indexOf('iphone') > -1){
    if (!((window.DocumentTouch && document instanceof DocumentTouch) || 'ontouchstart' in window)) {
        var script = document.createElement("script");
        script.src = "../appframework/plugins/af.desktopBrowsers.js";
        var tag = $("head").append(script);
    }
}else{
    $.feat.nativeTouchScroll=true;
}
/*初始化留言板*/
$(function(){
	document.getElementById('if').contentWindow.document.write('<head><style>' +
        'html{ overflow-x:hidden;} ' +
        'p{' +
        '   font-family: "microsoft yahei";' +
        '   padding: .2rem .5rem;' +
        '   font-size: .6rem;' +
        '   line-height: .8rem;' +
        '   background: #fffec3;' +
        '   border-radius: .5rem;' +
        '   border: 1px solid #662819;' +
        '}' +
        '</style></head>');
    document.getElementById('if').contentWindow.document.write('<body>');
    var act_name = '聊天框';
    var act_topic = '聊天话题';
    var start_time = '2014-09-17';
    var end_time = '2014-09-20';
    $.ajax({
        url:'../talk_init_servlet',
        type:'POST',
        data:'act_name='+act_name+'&act_topic='+act_topic+'&start_time='+start_time+'&end_time='+end_time,
        success:function(ret){
            var JSONObj = JSON.parse(ret);
            var son = '';
            for(var i=0;i<JSONObj.resp.data.categorys.length;i++){
                son+='<p name=\''+JSONObj.resp.data.categorys[i].generateTime+'\'>'+JSONObj.resp.data.categorys[i].msg+'</p>'
            }
            if_append(son);
        }
    });
    shit();
    document.getElementById('if').contentWindow.document.write('</body>');
    document.getElementById('if').contentWindow.document.write('</html>');
});

/*定时获取添加留言内容*/
function shit(){
    setTimeout(function(){
        var len = document.getElementById('if').contentWindow.document.getElementsByTagName('p').length;
        var times = document.getElementById('if').contentWindow.document.getElementsByTagName('p')[len-1].getAttribute("name");
        $.ajax({//定时获取用户数据
            url:'../get_message_servlet',
            type:'POST',
            data:'last_time='+times,
            success:function(ret){
                var JSONObj = JSON.parse(ret);
                var son = '';
                if(JSONObj.resp.head.status == 100){
                    for(var i=0;i<JSONObj.resp.data.categorys.length;i++){
                        son+='<p name=\''+JSONObj.resp.data.categorys[i].generateTime+'\'>'+JSONObj.resp.data.categorys[i].msg+'</p>'
                    }
                }else{
                    son+='';
                }
                if_append(son);
            }
        });
        shit();
    },3158);
}

/*添加留言内容*/
function if_append(mesg){
    document.getElementById('if').contentWindow.document.write(mesg);
}

/*用户提交留言内容*/
var flag =0;
function submit(){
    var xx = 2555;
    var mesg = document.getElementById('message').value;
    if(mesg == ''){
        alert('不能为空');
    }else{
        var uid = GetQueryString('tyh_web_uid');//用户ID
        var nick = GetQueryString('tyh_web_nick');//用户昵称
        if(flag ==0){
            flag =1;
            $.ajax({
                url:'../send_message_servlet',
                type:'POST',
                data:'uid='+uid+'&message='+mesg+'&nick='+nick+'&platform='+xx+'&app_version='+xx+'&aid='+xx,
                success:function(ret){
                    var JSONObj = eval('('+ret+')');
                    if(JSONObj.resp.head.status == 100){
                        flag=0;
                        document.getElementById('message').value='';
                    }else if(JSONObj.resp.head.status == 101){
                    }
                }
            })
        }
    }
}

function GetQueryString(name){   //获取浏览器的参数
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if(r!=null)return  unescape(r[2]); return null;
    }

/*5号奖项弹出框设置*/
function selShow(obj){
    var ID = $(obj).attr("id");
    $('#'+ID+' img').show();
    $("#myPopup").trigger("close");
}

/*点击手柄开始抽奖*/
$("#sb_left").bind("click",function(){
    $("#sb_left").hide();
    $("#arrow").hide();
    $("#sb_right").show();
    var re = Math.ceil(Math.random()*12+12);
    ani(re);
});
var T1 = 200;
var T2 = 100;
var T3 = 300;
/*获取数据前滚动*/
function ani(re){
    var ba = -0.04;
    var Y1 = toPercent(ba*4);
    var Y2 = toPercent(ba*(re-4));
    var Y3 = toPercent(ba*re);
    var t1 = T1*4;
    var t2 = T2*(re-8);
    var t3 = T3*4;
    $("#animate_ul").css3Animate({
        y: Y1,
        time: t1,
        success: function () {
            $("#animate_ul").css3Animate({
                y: Y2,
                time: t2,
                success: function () {
                    $("#animate_ul").css3Animate({
                        y: Y3,
                        time: t3,
                        callback: function (){
                            var me = re -12;
                            var mesg = msgTrans(me);
                            /*$("#afui .top").popup({
                                id:"myPopup",
                                message: mesg,
                                cancelOnly: true
                            });*/

                                $(document.body).popup({
                                    id:"myPopup",
                                    title: "",
                                    message: mesg,
                                    cancelOnly: true
                                });

                            /*submitAnswer(me);*/

                        }
                    });
                }
            });
        }
    });
}

/*关闭弹出框*/
$(".clo").bind("click",function(){
    $("#myPopup").trigger("close");
});
/*提交中奖内容*/
function submitAnswer(x){
    var uid = GetQueryString('tyh_web_uid');
    var type = translate(x);
    var ans;
    console.log(type);
    $.ajax({
        url:'../save_user_win',
        type:'POST',
        data:'uid=' +uid+'&win_type='+type+'&answer='+ans,
        success:function(ret){

        }
    });
}
/*中奖结果类型   分享--- 非分享*/
function translate(key){
    var dict = {'1':"1",'2':"1",'3':"0",'4':"0",'5':"0",'6':"0",'7':"0",'8':"0",'9':"1",'10':"0",'11':"0",'12':"0"};
    return dict[key];
}

/*12个奖项的弹出框*/
function msgTrans(num){
    var msg = [];
    msg[1]='<div class="pr wi hi" id="msg1"><img class="wi block pr" src="../dazhaxie/images/pop1_03_03.jpg">' +
        '<a class="pengyou pa on clo" onclick="window.location.href=" ></a> ' +
        '<a class="weixin pa on clo" onclick="window.location.href=" ></a> ' +
        '</div>';
    msg[2]='<div class="pr wi hi" id="msg2"><img class="wi block pr" src="../dazhaxie/images/pop2_03.jpg">' +
        '<a class="weibo pa clo" onclick="window.location.href=" ></a>' +
        '</div>';
    msg[3]='<div class="pr wi hi" id="msg3"><img class="wi block pr" src="../dazhaxie/images/pop3_03.jpg">' +
        '<input class="pa on" type="text">' +
        '<input class="pa on clo" type="button">' +
        '</div>';
    msg[4]='<div class="pr wi hi" id="msg4"><img class="wi block pr" src="../dazhaxie/images/pop4_03.jpg">' +
        '<input class="pa on" type="text">' +
        '<input class="pa on clo" type="button">' +
        '</div>';
    msg[5]='<div class="pr wi hi" id="msg5"><img class="wi block pr" src="../dazhaxie/images/pop5_03.jpg">' +
        '<div id="c1" class="pa clo" onclick="selShow(this)">' +
        '   <img class="pr wi hi on" src="../dazhaxie/images/select_03.png">' +
        '</div>' +
        '<div id="c2" class="pa clo" onclick="selShow(this)">' +
        '   <img class="pr wi hi on" src="../dazhaxie/images/select_03.png">' +
        '</div>' +
        '<div id="c3" class="pa clo" onclick="selShow(this)">' +
        '   <img class="pr wi hi on" src="../dazhaxie/images/select_03.png">' +
        '</div>' +
        '<div id="c4" class="pa clo" onclick="selShow(this)">' +
        '   <img class="pr wi hi on" src="../dazhaxie/images/select_03.png">' +
        '</div>' +
        '<div id="c5" class="pa clo" onclick="selShow(this)">' +
        '   <img class="pr wi hi on" src="../dazhaxie/images/select_03.png">' +
        '</div>' +
        '<div id="c6" class="pa clo" onclick="selShow(this)">' +
        '   <img class="pr wi hi on" src="../dazhaxie/images/select_03.png">' +
        '</div>' +

        '</div>';
    msg[6]='<div class="pr wi hi" id="msg6"><img class="wi block pr" src="../dazhaxie/images/pop6_03.jpg" />' +
        '<input style="z-index: 10000000000" class="pa on" type="text" />' +
        '<input class="pa on clo" type="button" />' +
        '</div>';
    msg[7]='<div class="pr wi hi" id="msg7"><img class="wi block pr" src="../dazhaxie/images/pop7_03.jpg" />' +
        '<a class="right pa on clo" onclick="window.location.href=" ></a> ' +
        '<a class="wrong pa on clo" onclick="window.location.href=" ></a> ' +
        '</div>';
    msg[8]='<div class="pr wi hi" id="msg8"><img class="wi block pr" src="../dazhaxie/images/pop8_03.jpg" />' +
        '<input class="pa on" type="text" />' +
        '<input class="pa on clo" type="button" />' +
        '</div>';
    msg[9]='<div class="pr wi hi" id="msg9"><img class="wi block pr" src="../dazhaxie/images/pop9_03.jpg" />' +
        '<div class="pengyou pa on clo" onclick="window.location.href=" ></div> ' +
        '<div class="weixin pa on clo" onclick="window.location.href=" ></div> ' +
        '</div>';
    msg[10]='<div class="pr wi hi" id="msg10"><img class="wi block pr on" src="../dazhaxie/images/pop10_03.jpg" />' +
        '<input class="pa wi hi on" type="text" />' +
        '<input class="pa wi hi on clo" type="button" />' +
        '</div>';
    msg[11]='<div class="pr wi hi" id="msg11"><img class="wi block pr" src="../dazhaxie/images/pop11_03.jpg" />' +
        '<input class="pa on" type="text" />' +
        '<input class="pa on clo" type="button" />' +
        '</div>';
    msg[12]='<div class="pr wi hi" id="msg12"><img class="wi block pr" src="../dazhaxie/images/pop12_03.jpg" />' +
        '<a class="mmd pa on clo" ></a> ' +
        '<a class="qdb pa on clo" ></a> ' +
        '<a class="hxq pa on clo" ></a> ' +
        '<a class="zsm pa on clo" ></a> ' +
        '</div>';
    return msg[num];
}
/*转换百分数*/
function toPercent(num){
    num = Number(num)*100+'%';
    return num;
}



function weixin_share(){
    var share_str = '{"sns_type":"weixin","request_code":"","share_type":"activity_type","click_url":"http://d.b17.cn/sactivity/weixin_free/pot.jsp","img_url":"http://static.etouch.cn/suishou/ad_img/3eqvu8khsdo.jpg","activity_key":"0tnie1cj","content":"韩式耐高温砂锅,免费抢到手软,根本停不下来！","title":"优惠君福利Time!","item_id":"","activity_key":"0tnie1cj","channel":"own","jifenbao_num":"0","sst":""}';
    local_info.share(share_str);
}

function friend_share(){
    var share_str = '{"sns_type":"pengyou","request_code":"","share_type":"activity_type","click_url":"http://d.b17.cn/sactivity/weixin_free/pot.jsp","img_url":"http://static.etouch.cn/suishou/ad_img/3eqvu8khsdo.jpg","activity_key":"0tnie1cj","content":"韩式耐高温砂锅,免费抢到手软,根本停不下来！","title":"优惠君福利Time!","item_id":"","activity_key":"0tnie1cj","channel":"own","jifenbao_num":"0","sst":""}';
    local_info.share(share_str);
}
function weibo_share(){
    var share_str = '{"sns_type":"weibo","request_code":"","share_type":"activity_type","click_url":"http://d.b17.cn/sactivity/weixin_free/pot.jsp","img_url":"http://static.etouch.cn/suishou/ad_img/3eqvu8khsdo.jpg","activity_key":"0tnie1cj","content":"韩式耐高温砂锅,免费抢到手软,根本停不下来！","title":"优惠君福利Time!","item_id":"","activity_key":"0tnie1cj","channel":"own","jifenbao_num":"0","sst":""}';
    local_info.share(share_str);
}

